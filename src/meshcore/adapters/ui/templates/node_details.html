<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node Details - {{ node.node_id.value }} - MeshCore HQ</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1>MeshCore HQ</h1>
        </div>
        <div class="nav-links">
            <a href="/" class="nav-link">Dashboard</a>
            <a href="/messages" class="nav-link">Messages</a>
            <a href="/compose" class="nav-link">Compose</a>
            <a href="/analytics" class="nav-link">Analytics</a>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <div>
                <h2>
                    <span class="status-indicator {{ node.last_seen|status_class }}"></span>
                    {{ node.node_id.value }}
                </h2>
                <p class="subtitle">Last seen: {{ node.last_seen|timeago }} ({{ node.last_seen|format_datetime }})</p>
            </div>
            <div class="header-actions">
                <a href="/telemetry/{{ node.node_id.value }}" class="btn btn-primary">View Telemetry</a>
                <a href="/messages?node_id={{ node.node_id.value }}" class="btn btn-secondary">View Messages</a>
            </div>
        </div>

        <!-- Node Info Grid -->
        <div class="info-grid">
            <div class="info-card">
                <h3>Basic Information</h3>
                <dl>
                    <dt>Node ID</dt>
                    <dd><code>{{ node.node_id.value }}</code></dd>
                    
                    <dt>First Seen</dt>
                    <dd>{{ node.first_seen|format_datetime }}</dd>
                    
                    <dt>Last Seen</dt>
                    <dd>{{ node.last_seen|format_datetime }}</dd>
                    
                    <dt>Total Events</dt>
                    <dd><strong>{{ node.event_count }}</strong></dd>
                </dl>
            </div>

            <div class="info-card">
                <h3>Telemetry</h3>
                {% if node.last_telemetry %}
                <dl>
                    {% for key, value in node.last_telemetry.items() %}
                    <dt>{{ key|replace('_', ' ')|title }}</dt>
                    <dd>{{ value }}</dd>
                    {% endfor %}
                </dl>
                {% else %}
                <p class="empty-hint">No telemetry data available</p>
                {% endif %}
            </div>

            <div class="info-card">
                <h3>Position</h3>
                {% if node.last_position %}
                <dl>
                    {% for key, value in node.last_position.items() %}
                    <dt>{{ key|replace('_', ' ')|title }}</dt>
                    <dd>{{ value }}</dd>
                    {% endfor %}
                </dl>
                {% else %}
                <p class="empty-hint">No position data available</p>
                {% endif %}
            </div>

            <div class="info-card">
                <h3>Last Message</h3>
                {% if node.last_text %}
                <p class="last-message">{{ node.last_text }}</p>
                {% else %}
                <p class="empty-hint">No messages yet</p>
                {% endif %}
            </div>
        </div>

        <!-- Recent Messages -->
        <div class="section">
            <h3>Recent Messages from this Node</h3>
            {% if messages %}
            <div class="messages-list">
                {% for msg in messages %}
                <div class="message-card">
                    <div class="message-header">
                        <span class="message-time">{{ msg.timestamp|timeago }}</span>
                    </div>
                    <div class="message-body">
                        {{ msg.text }}
                    </div>
                    <div class="message-meta">
                        {% if msg.to_node %}
                        <span class="badge">To: {{ msg.to_node }}</span>
                        {% else %}
                        <span class="badge badge-broadcast">Broadcast</span>
                        {% endif %}
                        <span class="badge">Channel {{ msg.channel }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty-hint">No messages from this node</p>
            {% endif %}
        </div>
    </div>
</body>
</html>

